db2 basics fun with dates and times paul yip published on august 28 2003facebook twitter linked in google email this page content series this content is part of the series db2 basics important read the disclaimer before reading this article this article is written for ibm速 db2速 for linux unix速 and windows速 this short article is intended for those who are new to db2 and wish to understand how to manipulate dates and times most people who have worked with other databases are pleasantly surprised by how easy it is in db2 the basics to get the current date time and timestamp using sql reference the appropriate db2 registers123select current date from sysibmsysdummy1select current time from sysibmsysdummy1select current timestamp from sysibmsysdummy1the sysibmsysdummy1 table is a special inmemory table that can be used to discover the value of db2 registers as illustrated above you can also use the values keyword to evaluate the register or expression for example from the db2 command line processor clp the following sql statements reveal similar information123values current date values current time values current timestamp for the remaining examples i will simply provide the function or expression without repeating select  from sysibmsysdummy1 or using the values clause to get the current time or current timestamp adjusted to gmtcut subtract the current timezone register from the current time or timestamp12current time  current timezonecurrent timestamp  current timezone given a date time or timestamp you can extract where applicable the year month day hour minutes seconds and microseconds portions independently using the appropriate function1234567year current timestampmonth current timestampday current timestamphour current timestampminute current timestampsecond current timestampmicrosecond current timestampextracting the date and time independently from a timestamp is also very easy12date current timestamptime current timestampyou can also perform date and time calculations using for lack of a better term english123current date  1 yearcurrent date  3 years  2 months  15 dayscurrent time  5 hours  3 minutes  10 secondsto calculate how many days there are between two dates you can subtract dates as in the following1 days current date  days date 19991022and here is an example of how to get the current timestamp with the microseconds portion reset to zero1 current timestamp  microsecond current timestamp microsecondsif you want to concatenate date or time values with other text you need to convert the value into a character string first to do this you can simply use the char  function123char current datechar current timechar current date  12 hoursto convert a character string to a date or time value you can use123456timestamp 20021020120000000000timestamp 20021020 120000date 20021020date 10202002time 120000time 120000the timestamp  date  and time  functions accept several more formats the above formats are examples only and ill leave it as an exercise for the reader to discover them warning what happens if you accidentally leave out the quotes in the date function the function still works but the result is not correct1 select date 20010922 from sysibm sysdummy1answer1205240006why the 2000 year difference in the above results when the date function gets a character string as input it assumes that it is valid character representation of a db2 date and converts it accordingly by contrast when the input is numeric the function assumes that it represents the number of days minus one from the start of the current era that is 00010101 in the above query the input was 20010922 which equals 2001922 which equals 1970 days date functions sometimes you need to know how the difference between two timestamps for this db2 provides a built in function called timestampdiff  the value returned is an approximation however because it does not account for leap years and assumes only 30 days per month here is an example of how to find the approximate difference in time between two dates123timestampdiff  n  char timestamp 20021130000000timestamp 20021108000000in place of n use one of the following values to indicate the unit of time for the result1  fractions of a second2  seconds4  minutes8  hours16  days32  weeks64  months128  quarters256  years using timestampdiff  is more accurate when the dates are close together than when they are far apart if you need a more precise calculation you can use the following to determine the difference in time in seconds12 days t1  days t2  86400  midnightseconds t1  midnightseconds t2for convenience you can also create an sql userdefined function of the above1234567create function secondsdiff t1 timestamp t2 timestampreturns intreturn  days t1  days t2  86400  midnightseconds t1  midnightseconds t2if you need to determine if a given year is a leap year here is a useful sql function you can create to determine the number of days in a given year1234567create function daysinyear yr intreturns intreturn case mod yr 400 when 0 then 366 elsecase mod yr 4 when 0 thencase mod yr 100 when 0 then 365 else 366 endelse 365 endendfinally here is a chart of builtin functions for date manipulation the intent is to help you quickly identify a function that might fit your needs not to provide a full reference consult the sql reference for more information on these functions sql date and time functions are as follows dayname returns a mixed case character string containing the name of the day eg friday for the day portion of the argument dayofweek returns the day of the week in the argument as an integer value in the range 17 where 1 represents sunday dayofweekiso returns the day of the week in the argument as an integer value in the range 17 where 1 represents monday dayofyear returns the day of the year in the argument as an integer value in the range 1366 days returns an integer representation of a date julianday returns an integer value representing the number of days from january 1 4712 b c the start of julian date calendar to the date value specified in the argument midnightseconds returns an integer value in the range 0 to 86 400 representing the number of seconds between midnight and the time value specified in the argument monthname returns a mixed case character string containing the name of month eg january for the month portion of the argument timestampiso eturns a timestamp value based on date time or timestamp argument timestampformat returns a timestamp from a character string that has been interpreted using a character template timestampdiff returns an estimated number of intervals of the type defined by the first argument based on the difference between two timestamps tochar returns a character representation of a timestamp that has been formatted using a character template tochar is a synonym for varcharformat todate returns a timestamp from a character string that has been interpreted using a character template todate is a synonym for timestampformat week returns the week of the year of the argument as an integer value in range 154 the week starts with sunday weekiso returns the week of the year of the argument as an integer value in the range 153 changing the date format a common question i get often relates to the presentation of dates the default format used for dates is determined by the territory code of the database which can be specified at database creation time for example my database was created using territoryus therefore the date format looks like the following123456values current date1053020031 record s selected that is the format is mmddyyyy if you want to change the format you can bind the collection of db2 utility packages to use a different date format the formats supported are def use a date and time format associated with the territory code eur use the ibm standard for europe date and time format iso use the date and time format of the international standards organization jis use the date and time format of the japanese industrial standard loc use the date and time format in local form associated with the territory code of the database usa use the ibm standard for u s date and time format to change the default format to iso on windows yyyymmdd do the following steps on the command line change your current directory to sqllibbnd for example on windows cprogram filesibmsqllibbnd on unix homedb2inst1sqllibbnd connect to the database from the operating system shell as a user with sysadm authority12db2 connect to dbnamedb2 bind db2ubindlst datetime iso blocking all grant public in your case substitute your database name and desired date format for dbname and iso respectively now you can see that the database uses iso date format123456values current date1200305301 record s selected custom datetime formatting in the last example we demonstrated how to change the way db2 presents dates in some localized formats but what if you wish to have a custom format such as yyyymmdd the best way to do this is by writing your own custom formatting function here is the udf1234567891011121314151617181920212223242526272829303132create function tsfmt ts timestamp fmt varchar 20returns varchar 50returnwith tmp ddmmyyyyhhmissnnnnnn as selectsubstr  digits day ts9substr  digits month ts9 rtrim char year ts substr  digits hour ts9substr  digits minute ts9substr  digits second ts9rtrim char microsecond tsfrom sysibmsysdummy1selectcase fmtwhen yyyymmddthen yyyy  mm  ddwhen mmddyyyythen mm    dd    yyyywhen yyyyddmm hhmissthen yyyy    mm    dd    hh    mi    sswhen nnnnnnthen nnnnnnelsedate format   coalesce fmt  null    not recognized endfrom tmp null the function code may appear complex at first but upon closer examination youll see that it is actually quite simple and elegant first we use a common table expression cte to strip apart a timestamp the first input parameter into its individual components from there we check the format provided the second input parameter and reassemble the timestamp using the requested format and parts the function is also very flexible to add another pattern simply append another when clause with the expected format when an unexpected pattern is encountered an error message is returned usage examples1234values tsfmt current timestampyyyymmdd20030818values tsfmt current timestampasadate format asa not recognized summary these examples answer the most common questions ive encountered on dates and times ill update this article with more examples if feedback suggests that i should in fact ive updated this three times already thanks to readers acknowledgements bill wilkins db2 partner enablement randy talsma disclaimer this article contains sample code ibm grants you licensee a nonexclusive royalty free license to use this sample code however the sample code is provided asis and without any warranties whether express or implied including any implied warranty of merchantability fitness for a particular purpose or noninfringement ibm and its licensors shall not be liable for any damages suffered by licensee that result from your use of the software in no event will ibm or its licensors be liable for any lost revenue profit or data or for direct indirect special consequential incidental or punitive damages however caused and regardless of the theory of liability arising out of the use of or inability to use software even if ibm has been advised of the possibility of such damages downloadable resources pdf of this content related topic download db2 expressccomments sign in or register to add and subscribe to comments subscribe me to comment notifications newest oldest popular 