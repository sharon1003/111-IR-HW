troubleshoot ftpnavigation search note it seems that greater than 90 of fog ftp problems are caused by badmismatched credentials because of this we recommend skipping straight to the credentials  passwords section first contents  hide 1 ftps roles in fog2 testing ftp21 try to get a file with linux22 try to get a file with windows3 ftp service31 fedora 2021222332 ubuntu4 ftp settings file41 fedora 2021222342 ubuntu5 disable  verify firewall51 fedora 2021222352 fedora 1653 debianubuntu54 windows 755 configuring firewall on linux6 credentials  passwords7 beware your browsers autofill8 interface9 ftp path10 permissions11 common problems and fixes111 my problem isnt in the wi ki112 image size on server 0113 you must first upload an image to create a download task114 ftpput  could not create file115 images stuck in imagesdev116 updating database failed117 large image  connection time out during delete capture and replication118 images wont finish capturing wont go past clearing ntfs flagftps roles in fogthe primary purpose is moving  renaming image files in the imagesdev folder to the images folder at the end of an image capture ftp is not used for image capture or deployment because nfs is faster ftp is also used to download kernels and delete images ftp is also used to report image size on server ftp is also used to ensure the image you wish to deploy exists before starting an image deployment ftp is also whats used for image replication in multiserver setups ftp should be able to read write and delete in imagesdev and images testing ftptry to get a file with linux these commands are not done on your fog server they are done on another linux machine this example uses fedora to explain whats happening below in the code boxcreate a test file with some data in it to send later start ftp may need installed first open connection to fog server provide username found in web interface  storage management  node name  management username provide password found in web interface  storage management  node name  management password change to images directory list directory contents upload file list directory contents to verify download the file delete the file exit ftp administratord620  echo some text here to send later  testtxt administratord620  ftp ftp open 10003 connected to 10003 10003 220 vs ftpd 302 name 10003administrator fog 331 please specify the password password 230 login successful remote system type is unix using binary mode to transfer files ftp cd images 250 directory successfully changed ftp ls 227 entering passive mode 10003204176 150 here comes the directory listing drwxrwxrwx 2 0 0 4096 apr 10 0338 optiplex745win xpconfigured april2015 drwxrwxrwx 2 0 0 4096 apr 10 0339 dev drwxrwxrwx 2 0 0 16384 apr 07 0158 lostfound drwxrwxrwx 2 0 0 4096 apr 08 0059 postdownloadscripts 226 directory send ok ftp put testtxt local testtxt remote testtxt 227 entering passive mode 1000313259 150 ok to send data 226 transfer complete 29 bytes sent in 0000114 secs 25439 kbytessec ftp ls 227 entering passive mode 1000311848 150 here comes the directory listing drwxrwxrwx 2 0 0 4096 apr 10 0338 optiplex745win xpconfigured april2015 drwxrwxrwx 2 0 0 4096 apr 10 0339 dev drwxrwxrwx 2 0 0 16384 apr 07 0158 lostfound drwxrwxrwx 2 0 0 4096 apr 08 0059 postdownloadscripts rwrr 1 1000 1000 29 apr 30 0029 testtxt 226 directory send ok ftp get testtxt local testtxt remote testtxt 227 entering passive mode 1000319081 150 opening binary mode data connection for testtxt 29 bytes 226 transfer complete 29 bytes received in 0000529 secs 5482 kbytessec ftp delete testtxt 250 delete operation successful ftp exit 421 timeout administratord620 try to get a file with windows explanation of the code below create a file with some data start ftpopen connection to fog server enter username found in web interface  storage management  node name  management username enter password found in web interface  storage management  node name  management password upload file list directory to verify download file close connection close ftpcsome folderecho this is a bit of text to throw into a file  texttxt csome folderftp ftp open 10003 connected to 10003 220 vs ftpd 302 user 10003 none fog 331 please specify the password password 230 login successful ftp put texttxt 200 port command successful consider using pasv 150 ok to send data 226 transfer complete ftp 45 bytes sent in 000seconds 2250kbytessec ftp ls 200 port command successful consider using pasv 150 here comes the directory listing texttxt 226 directory send ok ftp 10 bytes received in 000seconds 1000kbytessec ftp get texttxt 200 port command successful consider using pasv 150 opening binary mode data connection for texttxt 45 bytes 226 transfer complete ftp 45 bytes received in 000seconds 4500000kbytessec ftp close 221 goodbye ftp quit csome folderftp service fedora 20212223check the status of ftp withsystemctl status vsftpdservice should be on and green no errors and enabledstop start disable and enable ftp servicesystemctl stop vsftpdservice systemctl start vsftpdservice systemctl disable vsftpdservice systemctl enable vsftpdservice test that it’s functioning by using the testing instructions at the top of this article additionally if you open a web browser and go toftpxxxx use fog  yourfogaccountpassword for the credentials you should see “index of ”ubuntu restart ftp serviceservice vsftpd restart enable and disable are not available due to this service being in the upstart scripts test that it’s functioning by using the testing instructions at the top of this article additionally if you open a web browser and go toftpxxxx use fog  yourfogaccountpassword for the credentials you should see “index of ”ftp settings file fedora 20212223 locationetcvsftpdvsftpdconf to display filecat etcvsftpdvsftpdconf it should look a lot like thisanonymousenableno localenableyes writeenableyes localumask022 dirmessageenableyes xferlogenableyes connectfromport20yes xferlogstdformatyes listenyes pamservicenamevsftpd userlistenableno tcpwrappersyes seccompsandboxnoto editvi etcvsftpdvsftpdconf explanation of settingsman vsftpdconf ubuntu locationetcvsftpdconf to display filecat etcvsftpdconf it should look a lot like thisanonymousenableno localenableyes writeenableyes localumask022 dirmessageenableyes xferlogenableyes connectfromport20yes xferlogstdformatyes listenyes pamservicenamevsftpd userlistenableno tcpwrappersyes seccompsandboxnoto editvi etcvsftpdconf explanation of settingsman vsftpd instructions on using vi vi disable  verify firewall fedora 20212223disablestop firewallsystemctl disable firewalldservicesystemctl stop firewalldservice can be undone with start and enable check firewall in fedora 20212223systemctl status firewalldservice fedora 16add binbash to etcshells as the vsftpd yum install does not do it correctly causing tftp timeout message debianubuntusudo iptables lif disabled the output should look like this chain input policy accept target prot opt source destination chain forward policy accept target prot opt source destination chain output policy accept target prot opt source destination disable ubuntu firewallsudo ufw disable disable debian firewalliptables f iptables x iptables t nat f iptables t nat x iptables t mangle f iptables t mangle x iptables p input accept iptables p output accept iptables p forward acceptother debian settingsetchostsdeny this setting in the above file will deny traffic from any source except locally all all except 127001 denycomment out this line like soall all except 127001 denywindows 7start  control panel  view by small icons  windows firewall  turn windows firewall on or off  turn off all three configuring firewall on linux to set the firewall for linux to only allow what is necessary please see the fog security article credentials  passwords there are a few places where all the credentials on a standard install should match exactly web interface  storage management  your storage node  management username  management password web interface  fog configuration  fog settings  tftp server  fogtftpftpusername  fogtftpftppasswordthe local  fog  users password on the linux fog server server file optfogfogsettings  password for recent fog trunk versions only 120 does not have this setting 130 will though server file optfogfogsettings  username for recent fog trunk versions only 120 does not have this setting 130 will though all of those should match again on a standard installation to change the password of the local fog usersudo passwd fog to edit optfogfogsettingsvi optfogfogsettings instructions on using vi vi note for fog trunkfog 130 users if the password field inside of the optfogfogsettings file is set incorrectly every time you rerun the fog installer it will set the local fog users password to this incorrect password its important to set the password correctly in all of the above listed areas beware your browsers autofilloften times when people change a setting in storage management besides the username and password for a node most web browsers will autofill the username and password in without you knowing so if all youve changed is the interface name or replication bandwith or some other setting its possible your browser has autofilled the username and password and when you click save this incorrect autofilled username and password is stored the reason for your browser doing this is because of how its designed it assumes one set of credentials per site however fog has many sets of credentials and typically very few of them are the same there are some ways to avoid this first is to be careful dont needlessly click the save button if you havent changed anything second watch the username in most cases it should be fog watch the password length too another way to guarantee mostly that autofill doesnt fill in these fields is to use your browsers incognito or privacy mode in incognito or privacy mode all of your normal browser settings are not used instead you have a blank slate so autofill does not happen interface the interface defined within storage management for the storage node you are using must be correct for image moving at the end of a capture from dev to images at cli you can find the correct interface name by typing ip addr show in the output will be the correct interface name this is pictured below in a multiinterface system there will be multiple interfaces listed youll just need to pick the right one looking at the ip address assigned to the interface is the first way to determine the correct interface you must set this interface name inside storage management if its not already set correctly this problem is probably specific to fog 120 and older because the default storage node used the default value of eth0 this is fixed in 130 setting the proper interface name in storage management is pictured below ftp path the ftp path is the exact path used to interact with the image files via ftp this must be set correctly you can find the the settings here web interface  storage management  your storage node  ftp path most of the time the ftp path will be the same as the image path synology nas devices will have a different ftp path than the image path typically the root directory in the image path is excluded from the ftp path on synology nas devices permissions the credentials used for this storage management  storage node  management username  management password should exactly match the ownership of the images directory and all of its contents the path should also match the actual path to your images directory you can check the permissions on all your image files with thisls la r images you can enable all permissions just for troubleshooting on the images directory recursively like thissudo chmod r 777 images normally images and all of its contents should be owned by the local fog user whoever the owner is thats the credentials you should use in youre storage node username  password fields you can set ownership like thissudo chown r fogroot images common problems and fixes my problem isnt in the wi kiif you have a problem with fog or have a solution to a problem with fog please visit the forums for help or to report your solution we try to keep the wi ki updated with things found in the forum you can visit the forum here fog forums image size on server 0this is a common problem and is almost always due to ftp credentials being incorrect please see the credentials section above you must first upload an image to create a download task you may get this message when you try to deploy an image to computers ftp is used to validate that an image exists before creating an image task when an image does exist but cant be verified as existing you will receive the above error this can be caused by incorrect credentials permissions or when the storage nodes ftp path field is blank or incorrect its possible that firewall or selinux could be blocking ftp as well from what the fog community has seen in the forums most people who receive this error have mismatched credentials please see these to correct the problem troubleshootftpcredentials2fpasswords troubleshootftpftppath source deploymentftp not working ftpput  could not create file when attempting to update kernels or in other activities that utilize ftp you encounter an ftp put related error as pictured below solutions this error happens when the ftp credentials that are set for a specific function are valid for connecting via ftp but the credentials supplied have no permission on the filesdirectories that are to be manipulated this is not necessarily a credentials issue but can be resolved by supplying credentials that have permissions over the filesdirectories in question otherwise the username that is being used can be given permissions over the filesdirectories in question in whatever way that is appropriate this error can also occur if the file its downloading could not be moved to another location or could not be deleted please see above for examples on how to set permissions and how to change ftp credentials for the different areas images stuck in imagesdev images captures and are stored in imagesdev mac address of host and theyre never moved to images error messages on client at end of capture being close to completed ftp move failed ftp error cant renamemove permission denied fogftp failed to rename file solutions please see troubleshootftpcredentials2fpasswords above to correct the problem ensure the permissions on images and imagesdev are correct see troubleshootftppermissions above check you interface setting in storage managementfor older versions of ubuntu that have been upgraded to newer versions this error could be caused by an older ftp setting that may be grandfathered in during the upgrade process this setting may be commented out or set to no inside the settings file see above uncomment this and set it to yes like thiswriteenableyesnote moving images from imagesdev to images happens during image capture after attempting to correct the issue try to recapture and see if your image gets moved updating database failed an image capture goes to 100 and states that the task is complete but then says updating database failed an error has been detected could not complete tasking binfogupload computer will reboot in 1 minute this error is only seen in fog 130 and up due to the complete rewrite of the capture  deploy scripts pictured below solutions this can be ftp credentials and permissions related please look to the credentials and permissions section above large image  connection time out during delete capture and replication at first glance this problem looks a lot like the above problem because it will cause images to be stuck in imagesdev however this specific probelm is not credentials related its filesystem related if your images directory is formated with the ext3 filesystem you probably run into an issue where deleting the old image in images image name takes a very long time minutes with 100gb images and therefore the ftp connection times out and does not renamemove the newly captured image from imagesdev mac address to images image name or may not delete the image from images solution the solution is to have your images on a different filesystem like ext4 or lvm the issue is defragmentationreallocation in ext3 for a detailed explanation see here how to remove backups images wont finish capturing wont go past clearing ntfs flagthis is permissions related see forum threads for more detailsstuckafterclearningntfsflagimagingstuckonuploadafterfinished list permissionsls la r images fix permissions use the correct os user and correct storage node password to change ownership and give readwriteexecute to everyone assumes user is fogchown fog r images chmod r 777 images changing ownership with user and group replace user and group with actual valueschown usergroup r images 