mx record from wikipedia the free encyclopedianavigation search a mail exchanger record  mx record is a type of certified and verified resource record in the domain name system that specifies a mail server responsible for accepting email messages on behalf of a recipients domain and a preference value used to prioritize mail delivery if multiple mail servers are available the set of mx records of a domain name specifies how email should be routed with the simple mail transfer protocol smtp contents  hide 1 overview2 mx preference distance and priority21 the basics22 load distribution among an array of the mail servers23 the backup mx24 priority25 spammers3 history of fallback to address record4 standards documents5 see also6 references overview  editresource records are the basic information element of the domain name system dns they are distinguished by a type identification a mx ns etc and a dns class internet chaos etc the records have a validity period  timetolive assigned to them indicating when the information they hold must be refreshed from an authoritative name server resource records are organized within the dns based on their name field which is a fully qualified domain name fqdn of a node in the dns tree in the case of an mx record this specifies the domain name of a mail recipients email address ie the portion after the  symbol that delimits the recipients account name the characteristic payload information of an mx record is the fully qualified domain name of a mail host and a preference value the host name must map directly to one or more address record a or aaaa in the dns and must not point to any cname records 1when an email message is sent through the internet the sending mail transfer agent mta queries the domain name system for mx records of each recipients domain name this query returns a list of host names of mail exchange servers accepting incoming mail for that domain and their preferences the sending agent then attempts to establish an smtp connection the mx mechanism provides the ability to run multiple mail servers for a single domain and allows administrators to specify an order in which they should be tried this ability to run multiple mail servers proves very valuable for highavailability clusters of inexpensive mail gateways which can then process hundreds of messages per second in aggregate to quarantine or remove spam andor viruses the mx mechanism does not grant the ability to provide mail service on alternative port numbers nor does it provide the ability to distribute mail delivery across a set of unequalpriority mail servers by assigning a weighting value to each one mx can be used to distribute delivery across equalpriority mail servers 2mx preference distance and priority  editaccording to rfc 5321 the lowestnumbered records are the most preferred 3 this phrasing can be confusing and so the preference number is sometimes referred to as the distance smaller distances are more preferable an older rfc rfc 974 indicates that when the preference numbers are the same for two servers they have the same priority hence those two terms are used interchangeably the basics  editin the simplest case a domain may have just one mail server for example if an mta looks up the mx records for examplecom and the dns server replied with only mailexamplecom with a preference number of 50 then the mta will attempt delivery of the mail to the server listed in this case the number 50 could have been any integer permitted by the smtp specification but when more than one server is returned for an mx query the preference number for each record dictates the relative priority of the listed server when a remote client typically another mail server does an mx lookup for the domain name it gets a list of servers and their preference numbers the smallest preference number has the highest priority and any server with the smallest preference number must be tried first to provide reliable mail transmission the smtp client must be able to try and retry each of the relevant addresses in this list in order until a delivery attempt succeeds 3 if there is more than one mx record with the same preference number all of those must be tried before moving on to lowerpriority entries load distribution among an array of the mail servers  edita technique used to distribute the load of incoming mail over an array of servers is to return the same preference number for each server in the set when determining which server of equal preference to send mail to the sendersmtp must randomize them to spread the load across multiple mail exchangers for a specific organization unless there is a clear reason to favor one 3 note that multihomed servers are treated differently since in this case any randomization is assumed to have been applied already by the name server this mainly addresses routing problems other types of server load can be addressed by using an smtp proxy the other alternative mentioned in the rfc is to use what appears to be a multihomed a record for a mail server it may in fact be an array of mail servers that share the same host name this method places the burden on the dns system rather than the smtpsender to perform the load balancing which in this case will present a list of ip addresses in a specific order to the clients querying the a record of the mail exchanger since the rfc requires that the smtpsender use the order given in the a record query the dns server is free to carefully manipulate its balancing based on any method including round robin dns mail server load or some undisclosed priority scheme the backup mx  edita target server ie one that knows how to deliver to the relevant users email mailbox is typically one which is the most preferred lower priority servers aka backup mx or secondary mx usually keep the messages in a queue waiting for the primary server to become available if both servers are online or in some way connected to one another the backup mx will typically queue a message briefly and immediately forward it to the primary mx the backup mx acts as a store and forward mail server priority  editmail is delivered to the mail exchange server with the lowest preference number highest priority so the mx record you use for mail routing should have the lowest preference number typically 0 for example use 0 for your mail routing record and 10 for the record for validating that you own your domain the mx priority determines the order in which the servers are supposed to be contacted if several servers with different priorities are given the server s with the highest priority and the lowest preference number will be tried first in dns records typically the preference number is set and shown  but often erroneously labeled priority a common misconception about the mx preference ordering is that it is intended to increase the likelihood that mail may be delivered however merely having multiple mx records with the same preference provides this benefit because the mx preference ordering specifies that some servers should be tried first it is if anything a means of establishing load imbalance another common misinterpretation of mx preference ordering is that it is intended to provide a means of failover in the case of server overload while it can be used that way it is a poor resource management technique because it intentionally creates overload and does not fully utilize the available hardware assigning the same preference value to all of the available servers provides the same benefit and may even help avoid overload situations and thereby increase system throughput by decreasing latency the smtp protocol establishes a storeandforward network and if a domains mail servers are all offline sending servers are required to queue messages destined for that domain to retry later however these sending servers have no way of being notified that a previously offline domains servers are now available the sending servers will only discover that the domain is available whenever delivery of the delayed messages is next attempted the delay between when a domains servers come online and when delayed messages are finally delivered can be anywhere from minutes to days depending on the retry schedule of the sending servers this is the problem that backup mx records are uniquely qualified to solve the idea is that the servers listed as secondary mx servers have some outofband way of knowing when the primary servers are back online thus they are a more useful place to queue messages when the primary servers are offline than the original senders queue the question then becomes if the secondary servers are still online why not give them the same priority as the rest of the domains mx records secondary servers are ones that for whatever reason cannot or should not be used normally but that can be used if the primary servers are offline reasons for them to not be used normally can vary widely but here are some examplesthe backup server is owned by a different company or organizationthe backup server does not have direct access to the primary mail storagethe backup server cannot determine valid recipient addressesthe backup servers internet bandwidth costs morethe backup server has significantly less internet bandwidththe backup server has a highlatency internet connection spammers  editspammers frequently direct mail to one of the backup high distance mx servers of a domain first in order to avoid any antispam filters that may be running on the primary lowest distancehighest preference exchanger backup mx servers often have different antispam software and using them can hide the spammers ip address from the primary mx servers this can be foiled by using bogus highdistance mx servers alternatively sometimes spammers only target the lowestdistance mx records for domains and do not fall back to higherdistance mx records when the lowestdistance mx records are unreachable a technique called nolisting will defeat this behavior the smtp rfc 3 is ambiguous about exactly what kinds of delivery failure must result in reattempting delivery via more distant mx records those with higher preference values for example sometimes servers indicate temporary failures either by explicitly sending a 4xx error or by ending the connection unexpectedly which must be treated as a 451 error according to section 38 of the rfc if there is a temporary failure should a more distant mx record be attempted or should the sender wait and retry later according to section 4541 the sender must delay retrying a particular destination after one attempt has failed but when the sender retries later the rfc is silent about whether the sender should retry the same server that gave the previous temporary error or a more distant mx record it does say in section 51 when the lookup succeeds the mapping can result in a list of alternative delivery addresses rather than a single address because of multiple mx records multihoming or both to provide reliable mail transmission the smtp client must be able to try and retry each of the relevant addresses in this list in order until a delivery attempt succeeds it is not specific about what should cause the sender to use a higherpreference mx record merely that the sender must be able to use higherpreference mx records some servers such as sendmail and postfix 21 or later 4 will attempt the nextfurthest mx server after some types of temporary delivery failures such as greeting failures 5 other servers such as qmail and postfix 20 or earlier will only use more distant mx records if the servers specified in the shortestdistance mx records could not be contacted at all both behaviors are valid since the rfc is not specific reattempting with more distant mx records makes a lot of sense if the primary mxs failure is considered nonauthoritative that is if there is an expectation that the message may yet be delivered by the backup mx servers this is often phrased as if the alternative is giving up and not delivering the mail why not try the higherpreference mxs 6 however if the primary mxs failure is considered authoritative ie it is the primary server for a nonarbitrary reason attempting to deliver to secondary mx servers is not only a waste of time but potentially a waste of expensive resources depending on the reason why the secondary servers have higher preference values the different mxhandling behaviors of email servers  mtas often comes up in discussions of nolisting and similar antispam strategies that rely on manipulating the mx order and exercising mta failure handling mechanisms regardless of how one interprets the rfcs there is an advantage to choosing to deliver to higher numbered mx records when receiving a 4xx error from a primary mail server if the primary server is overloaded or experiencing some other temporary failure the backup server can accept the email and process it this means the email is delivered faster than waiting to retry the primary server until it recovers some front end spam filtering services apply gray listing techniques on only the primary server to discourage spam bot email sending servers that retry the higher mx records will be able to deliver their outgoing mail immediately while servers like qmail will be delayed typically for an hour till the primary server allows it so servers that retry higher numbered mx records gain a performance advantage history of fallback to address record  editrfc 821 was published in 1982 it makes only passing references to dns because at the time the transition from hosts txt to the dns had not yet started rfc 883 the first description of the dns was published over a year later in late 1983 it described the experimental and little used md and mf records according to rfc 897 and rfc 921 the transition to dns started in 1983 but hosts txt was not scheduled to be phased out until the end of 1985 and was not totally phased out until the late 1990s in january 1986 rfc 973 and rfc 974 deprecated the md and mf records replaced them with mx and defined the mx lookup with fallback to a rfc 974 recommends that clients do a wks lookup 7 on each mx host to see if it actually supports smtp and discard the mx entry if not however rfc 1123 changed this to say that wks should not be checked this means that smtp had been in use for at least a year using hosts txt and then another couple of years using a md and mf before mx came along md and mf were hard to use so most people just used the a record under the circumstances mx without fallback to a would not have worked because of the substantial installed base of mail servers using a records the early use of mx was to identify gateways to other networks but it did not come into wide use until the dns was well established in the early 1990s 8rfc 5321 sec 5 states smtp clients must look up an mx recordif and only if no mx record for the domain is present treat the domain as if it had an mx record with the given domain as the target hostname and a preference value of 0perform a or aaaa lookups as required to determine the ip address of the target hostname standards documents  editrfc 1035 1987 domain names  implementation and specification rfc 1912 1996 common dns operational and configuration errors rfc 5321 2008 simple mail transfer protocol rfc 7505 2015 a null mx no service resource record for domains that accept no mail obsoletes rfc 2821 2001 simple mail transfer protocol obsoleted by rfc5321rfc 974 1986 mail routing and the domain system obsoleted by rfc5321see also  editsrv record  a similar dns record for advertising other network services sender policy framework  somewhat of a reverse mx record saying where mail gets sent from rather than sent to list of dns record types a record nolisting references  edit rfc 2181 section 103 clarifications to the dns specification r elz r bush july 1997 howto  configure round robin and load balancing page modified february 28 2014 zytraxcom a b c d rfc 5321 if the primary mx responds but fails midtransaction postfix 12 and 20 will not try a backup mx archived 20090623 at the wayback machine  re does not change to mx with lower priority from victor duchovni victor duchovni morgan stanleycom date fri nov 11 2005 a greeting failure is an errorcode that is sent instead of or in response to the standard smtp greeting handshake this argument ignores the fact that in most cases such as with sendmail and postfix the more distant mxs may be used long before the server gets close to giving up craig partridge january 1986 mail routing and the domain system ietf doi 1017487rfc0974 rfc 974 retrieved 18 november 2011 for each mx a wks query should be issued to see if the domain name listed actually supports the mail service desired mx rrs which list domain names which do not support the service should be discarded this step is optional but strongly encouraged  this section is adapted from john levine ietfsmtp message archived 20080601 at the wayback machine categories dns record types email 