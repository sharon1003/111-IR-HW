table of contents › the where clause › functions ›userdefined functions functionbased indexing is a very generic approach besides functions like upper you can also index expressions like a  b and even use userdefined functions in the index definition there is one important exception it is for example not possible to refer to the current time in an index definition neither directly nor indirectly as in the following example create function getage dateofbirth date return number as begin return trunc monthsbetween sysdate dateofbirth12  endthe function getage uses the current date  sysdate to calculate the age based on the supplied date of birth you can use this function in all parts of an sql query for example in select and the where clauses select firstname lastname getage dateofbirth from employees where getage dateofbirth  42the query lists all 42yearold employees using a functionbased index is an obvious idea for optimizing this query but you cannot use the function getage in an index definition because it is not deterministic that means the result of the function call is not fully determined by its parameters only functions that always return the same result for the same parameters—functions that are deterministic—can be indexed on my own behalf check my offerings at httpswinandat — sql training sql expert teammate on demand free sql resources for developers and more the reason behind this limitation is simple when inserting a new row the database calls the function and stores the result in the index and there it stays unchanged there is no periodic process that updates the index the database updates the indexed age only when the date of birth is changed by an update statement after the next birthday the age that is stored in the index will be wrong besides being deterministic postgre sql and the oracle database require functions to be declared to be deterministic when used in an index so you have to use the keyword deterministic oracle or immutable postgre sql caution postgre sql and the oracle database trust the deterministic or immutable declarations—that means they trust the developer you can declare the getage function to be deterministic and use it in an index definition regardless of the declaration it will not work as intended because the age stored in the index will not increase as the years pass the employees will not get older—at least not in the index other examples for functions that cannot be “indexed” are random number generators and functions that depend on environment variables note db2 cannot use userdefined functions in indexes not even if they are deterministic tip how can you still use an index to optimize a query for all 42yearold employees previous page next page about the author markus winand teaches efficient sql— inhouse and online he minimizes the development time using modern sql and optimizes the runtime with smart indexing his book entitled sql performance explained has become standard reading buy his book on amazon the essence of sql tuning in 200 pages buy on amazon paperback onlypaperback and pdf also available at markus’ store hire markus markus offers sql training and consulting for developers working at companies of any size learn more »tweet follow markus winand follow sqlperf tipsvote vote