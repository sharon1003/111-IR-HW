introductionelectromotive force emf refers to the voltage generated by a spinning motor measuring this voltage in order to determine the rotational speed of a motor is commonly called backemf since the voltage tends to pushback against the circuit driving current into a motors windings this speed indication may be used in motion control algorithms to modulate the velocity or to compute the angular distance the motor has traveled over time the details of backemf based motion control feedback are presented below typically a motor takes power in the form of voltage and current this power is converted over time into mechanical energy in the form of rotation with a generator this process is simply reversed it takes mechanical energy and converts it into electrical energy with a voltage and current most motors can be generators by just spinning the motor and looking for a voltagecurrent on the motors windings a simple demonstration of this effect is to wire two motors together spinning one motor causes the other to spin based on the current created when turning the windings of the first motor when using backemf measurements for motion control the concept that a motor is also a generator is exploited the motor is run almost continually with current being driven into the windings occasionally and for a very short period of time the process is reversed the drive circuitry stops supplying current and the windings are allowed to electrically float the inertia in the motor system keeps it spinning and a measurement of the voltage from the spinning motorgenerator is taken this process can happen in a exceedingly short time so it is nearly invisible to the an observer of the motor the voltage observed when the motor is spinning is directly proportional to its rotational velocity and the physical properties of the motor as such the motors rotational velocity can be computed with no optical encoders or other forms of active feedback the processreading the rotational velocity from a motor using backemf requires two alternating steps first the motor is run for some period of time by providing current to the windings this current can be supplied as a constant voltage or a pulse width modulated pwm motor input the latter is the most common since it allows for the motor speed to be varied the second step is to remove the driving voltage and electrically float the windings electrically floating means there is no active circuit between the windings and any other sourcesink a circuit capable of measuring the voltage across the windings can then be connected or activated the inertia in the motor and mechanical system causes the motor to continue to spin long enough to measure the voltage produced by the motor typically these steps are alternated at roughly 50hz or once every 20 milliseconds the time required for the motor to flip from a motor to a generator depends on the inherent capacitance and stored charge in the inductance of the motor windings this time is typically on the order of milliseconds 12ms and depends on many conditions and characteristics of the motor watching the process on an oscilloscope can provide insight into the time response of the motor system some illustrated oscilloscope pictures are presented below to show these various steps and introduce some terminology used to control a motor using backemf these illustrations are based on an example setup where a microcontrollers logiclevel pwm output is used to control an hbridge the microcontroller is also used to indirectly measure the backemf voltage after filtering and scaling using a builtin a2d25 simulated duty cycle the diagram above illustrates how an oscilloscope might look when running a motor at 14 speed from a pwm drive circuit notice how the backemf voltage stabilizes at roughly 14 of the pwm maximum voltage if the backemf measurement gap is too long the motor will begin to slow down and the voltage will drop accordingly75 simulated duty cycle by increasing the pwm dutycycle to 34 speed an oscilloscope reading would appear approximately as illustrated above this diagram is similar to the previous one but now the stable backemf signal is roughly 34 of the maximum motor winding drive voltage75 simulated duty cycle with high load finally the diagram above illustrates the 34speed case with the motor under load increasing the load on the motor causes it to draw more current from the drive circuitry while it is supplying volage the higher current in the motor windings causes a larger inductance in the windings the inductive spike is larger in magnitude and it takes longer to stabilize to the backemf region the duration of the inductive spike is based on the time for the system to dissipate power in the inductance and capacitance of the motor winding system proper tuning of the measurement latency the time before taking the backemf measurement is important to minimize the measurement gap while allowing enough time for stable and accurate backemf measurement backemf measurement circuitsdesigning a backemf measurement circuit is challenging the circuit needs to handle possibly large voltages from the motor and convert them into a voltage range an analog to digital a2d converter can handle the circuit also needs to tolerate large inductive voltage spikes further the voltage across the motor windings invert when the motor direction changes so the circuit needs to adjust the voltage polarity and range and create an input offset so that the neutral not spinning voltage output of the measurement circuit centers around a known value if the motor is only running in one direction the circuit can be as simple as a resistor ladder to scale the voltage to a desired a2d input range such as an a2d built into a microcontroller if the motor is running bidirectionally a more sophisticated circuit is required at one time acroname offered an hbridge which used a twostage operational amplifier to manage the voltage scaling and offset of the backemf measurement since that circuit used the lmd18200 hbridge driver turning on the brake is used to ensure that the motor windings are floating during the backemf measurement gap activation of the brake during a backemf measurement is sometimes referred to as auto braking there are as many ways to measure the voltage in a backemf circuit as there are potential motor direction and voltage combinations the key is to ensure that the measurement is passive so it doesnt affect the motor that it is executed when the drive circuit is not active and that it is fast so that the motor can spend most of the time supplying mechanical force to the system limitationsbackemf velocity measurement is especially useful if it is not possible to utilize an encoder on the motor or drivetrain high quality quadrature encoders will typically out perform any backemf measurement method described here in addition encoders can give absolute position information whereas backemf report velocity position must be computed through integrating the velocity over time which can introduce significant and accumulating errors another limitation of backemf velocity control is that it effectively reduces the maximum duty cycle that can be employed on the motor driver as it requires the motor to be turned off at times during the operation to facilitate measurements credit and attributionbackemf motion control has been employed for decades with uses in model trains audio tape transport mechanisms and other special purpose uses acroname first learned of this approach to speed control while talking with randy sargent about work he and bill bailey were doing with velocity measurement for robotics it was subsequently integrated into the garcia robot platform thanks to randy and bill for sharing this information with the robotics community 