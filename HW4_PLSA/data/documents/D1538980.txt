configure citrix net scaler 105 including gateway and citrix store front 252july 6 2014 robin hobo net scaler 91 comments citrix released the citrix net scaler 105 in this blog i will show you how to setup this new net scaler including creating and installing a ssl certificate and how to create and configure the gateway feature i will also show you the steps that needs to be made within citrix store front 252 configuration before starting with the installation and configuration make sure there is a license file for the net scaler and that there are at least three ip address available for the configuration the access gateway function needs a ssl certificate make sure you can create a ssl certificate by a certificate authority ca and that there is an external dns record in place for this blog a used net scaler vpx for xen server 105 build 509 as source the steps for downloading and uploading the net scaler to the hypervisor are not covered in this blog for these steps see my previous net scaler blog  click here  also the steps of how to install citrix store front are not covered you can find these steps in my store front blog  click here  good news with net scaler 105 you no longer need java which is a really big improvement there are a lot more improvements like a ssl certificate chain check see later in this blog and a very improved setup wizard let’s get started…configuring net scaler 105after downloading the net scaler sources from the citrix site and uploading it to the hypervisor it’s time to walk through the console configuration wizard turn on the net scaler and open the net scaler console on the hypervisor fill in the following information– ipv4 address – netmask – gateway ipv4 address choice option 4 to save and quit after that the net scaler will reboot after rebooting the net scaler open a browser and browse to the nsip address management interface ip address you entered in the previous step login with user name nsroot and password nsroot citrix net scaler 105 has a very improved firsttime setup wizard making it possible to setup the net scaler in a few clicks click on step 2 subnet ip address good explanation about the subnet ip address within this wizard even an infographic is displayed nice fill in the subnet ip address and click done click on step 3 to configure host name dns ip address and time zone fill in the net scaler host name the dns ip address and the correct time zone click done if you have a license file select upload licenses files from a local computer and click browse after uploading the license file click reboot create a ssl certificate the next step is the install the ssl certificate browse to traffic management  ssl and click on create rsa key fill in the following informationkey filename “name”key anything you like key size bits 2048 public exponent value f4 key format pem pem encoding algorithm des3 pem passphrase a password you like verify rassphrase same as above click on ok click on create csr certificate signing requestfill in the following informationrequest file name anything you like key file name browse to the  key file you just created key format pem pem passphrase for encrypted key the password you specified in the previous step browse to the bottom of the page and fill in the following informationcountry your country state or province you state or province organization name the name of your organization city name your city email address a valid email address organization unit your organization unit common name this is the address the users will type in their browsers challenge password a password you like company name your company name click okto download the request file click on manage certificates  keys  csrs select the request file in my case this is robinhobocomtxt and click download open the request file with notepad and copy all the text go to your certificate authority in my case this is go daddy to create the key or rekey an existing certificate by pasting the text from the request file after creating the certificate download it select iis7 as server type browse to traffic management  ssl  certificates and click on install fill in a certificatekey pair name anything you like on the right side of the certificate file name click the arrow down button and select local to browse to the downloaded certificate browse to the key file name on the appliance select pem as certificate format fill in the password entered when creating the request file and click on install after the installation you can see the status and the number of days the certificate expires configuring the net scaler 105 gateway under integrate with citrix products click on xen app and xen desktop the before you begin checklist is presented we have already a server certificate installed the ldap authentication server details will be configured during this wizard click get started an infographic is displayed with your deployment options at this point the single hop deployment is my only option select storefront as integration point and click continue fill the virtual server name anything you like the net scaler gateway ip address this is the ip address where the outside ip address must point to fill in the port number 443 and optionally you can enable the redirect request from port 80 to a secure port fill in the address without “https” click continue select use existing certificate select the certificate that is installed in the previous steps and click continue citrix net scaler checks if the certificate chain of the ssl certificate is complete a really great new feature in my case the certificate chain is incomplete net scaler is displaying the missing parts of the chain that are needed and where to find themafter installing all the certificates net scaler displays the server certificate including the complete chain scroll down to configure the ldap configuration select add new server and fill in the following informationip address the ip address of a domain controller port 389 base dn for example dcrobin hobodccom service account an account with ad read rights server logon name attribute choose s amaccount name for xen appxen desktop deployments password the service account password confirm password same as above click continue an ldap authentication policy and server are now automatically created scroll down to configure the store front server fill in the following informationstore front fqdn the fqdn of the store front server site path the site path of the receiver for web store url for me this is citrixhobo web single signon domain your internal domain name store name your store front storename secure ticket authority server the sta address of your xen app or xen desktop controller protocol protocol used by the server storefront server storefront server ip address of the store front server port the port number used by store front optionally you can enable load balancing and enter the ip address of the virtual loadbalance server click on continue to configure your xen farm select what you are using xen app xen desktop or both fill in the ip address of the xen app  xen desktop controller server and the used services port if you want to configure load balancing on your controllers select load balancing to enter the ip address of the virtual lb server click continue to apply optimize tcp profile settings optimize ssl quantum settings http caching and http compression click apply click okto apply app fw policies and profiles click apply to apply hdx insight app flow policies click apply click done optionally you can change the default theme of the net scaler webinterface to do so browse to net scaler gateway  global settings and click change global settings open the client experience tab browse to the bottom and select the ui theme you want i select the green bubble theme because i have the same theme with storefront click oksave the configuration and reboot the net scaler configure storefront 252 for remote access the final step is to configure citrix storefront 252 for remote access with citrix net scaler 105 logon to the storefront server and open the console browse to authentication and click on addremove methods make sure you enable passthrough from net scaler gateway and click okgo to net scaler gateway and click on add net scaler gateway appliance fill in the following informationdisplay name any name you like net scaler gateway url the external url of the gateway version 100 build 694 or later logon type domain callback url the external url of the gateway click next click add to add a secure ticket authority staadd httpfqdn of xen appxen desktop controller and click okclick create click finish open the stores page and click on enable remote access select no vpn tunnel select the just created net scaler gateway appliance and click okat this point everything should be working fine if you open a browser en browse to the external url you will see that https is used and that the certificate icon is displayed after logon you will see the published applications and desktops in the storefront interface with the same these as the net scaler gateway robin hobo robin hobo works as a consultant mobility with focus on different enterprise mobility management emm solutions like citrix xen mobile microsoft enterprise mobility  security ems vmware workspace one  air watch black berry and mobile iron in recent years robin did many technical implementations of different products these were mainly citrix and microsoft products related articles installing and configuring citrix xen desktop 56may 11 2013installing and configuring citrix store front 12march 8 2013installing and configuring citrix xen mobile mdm 86november 8 201391 comments leave new bas van kaam july 6 2014 241 pm again great work robinreply robin hobo july 6 2014 704 pm thanks basreply zombo brain july 6 2014 1018 pm hello tried the same today and it worked instead of a full license i tried it with a net scaler express license in this license aaa is not included the wizzard you show and explain here doesn’t work in this case so i had to use the “old” 101 wizard which is a bit hidden you could add this to your post for the people who use the express to grant remote access for only a few people in their company reply robin hobo july 7 2014 801 am hallo brain good to know that thanks for the inforeply dipak july 7 2014 721 am great article thanks reply d kumar july 7 2014 1041 am thanks for your efforts reply robin hobo july 7 2014 1047 am your welcomereplyvadim july 8 2014 1051 am hello i’ve the same error “upload an issuer certificate with the following subject name” i’ve upload digi cert cacrt certificat  “mydomaincrt” certificat the certificate chain is incomplete upload an issuer certificate with the following subject name cusodigi cert incouwwwdigicertcomcndigi cert global root ca how do you resolve this problem  thanks for this article it’s was very usefull form me reply robin hobo july 8 2014 1239 pm hi vadim go to httpwwwdigicertcom download the digi cert global root ca and install it on your net scaler reply andrey july 8 2014 151 pm fantastic thank you for your assistance i was a little bit confused with a new interface replydhananjay khobare july 10 2014 717 pm thanks you  nice reply chris july 23 2014 216 am great post robin i have just gone through this pain and have 2 notes worthy of a mention 1 – netscaler mpx8200 running 101126 does not support certificate algorithm stength above 256 you get ‘invalid certificate type’ when trying to install a cert with a higher algorithm such as 384ecdrsa this might be different on higher spec’d machines 2 – for those behind firewalls that have the access gateway in a dmz we had to create an access gateway virtual server with an internal dmz addess to act as the callback url we then added a host entry on the storefrontddc servers to resolve the external url to the internal dmz address this may not be the correct way to do it but we have no routing from our internal network to the external interface of the netscaler and at 2am you kind of run out of options reply james july 23 2014 1004 pm very nicethank youreply chris july 25 2014 742 am thanks for your new guide robin i have the same error as zombo brain with my standard license i found this citrix workaround at the forums using a temporary platinum license and switching back to the real one after the installation has done the trickhttpdiscussionscitrixcomtopic353404netscalergateway105thefollowinglicensesarenotavailableaaareply robin hobo july 25 2014 750 am great thanks for the updatereply izaak july 27 2014 754 am great details explanation thanks isreply bjorn august 1 2014 1237 pm hi allin training we did the same setup and used the same version of netscaler 105 and zendertje 75everything works well but when connecting to a desktop windows 81 we all had double mouse cursors did one of you had the same problem reply robin hobo august 1 2014 1250 pm on what hypervisors are the vdi’s running reply bjorn august 1 2014 200 pm on xenserver ver 62reply robin hobo august 4 2014 1230 pm yip that’s correct reply christos petousis august 1 2014 234 pmcongratulations we need more reply chad august 1 2014 600 pm robinvery nice write upi am having an issue with netscaler vpx 3000 and wondering if you have come across it when ever i try to generate a csr after all the fields all filled out my browser just spins nothing happens i have let it sit for 30 min and and i get kicked off the netscaler gui and have to log back in any assistance would be greatly appreciated thankschad reply chad august 1 2014 601 pm forgot to mention this is 105 build 5010nc reply robin hobo august 4 2014 1231 pm hi chad never had that problem before can you try it with chrome reply rconnect august 5 2014 1228 am i have done all has mention in this great tutorial but i keep getting “cannot complete request” when going trought netscaler but if i use internal works perfect any idea reply rconnect august 5 2014 1242 am sorry nevermind i have fix the problem i was putting the wrong callback url great article and site thanks reply mike august 8 2014 913 pm have 105 netscaler up and running can connect with receiver for windows but when trying to connect with ipad or i phone it fails to connect error says could not connect to server i am new to this and am learning on the fly any help as to where to look would be great reply how to net scaler 105 as saml identity provider  net scaler rocksaugust 12 2014 932 pm … the server that we will authenticate against we will not describe this in detail as there are many blogs  articles on this and the gui is also quite self …reply arun maharana august 15 2014 242 pm nice article reply mohan august 18 2014 1057 pm hey robin great job man appreciated reply adam bergsbaken august 21 2014 754 pm i am stuck with cannot complete your request error when i try to access from external… confused by you select port 443 for your storefront servers but used http and not ssl reply robin hobo august 22 2014 757 am try to add the following line in the host file of the storefront server s for example 19216815 citrixrobinhobocom reply adam bergsbaken august 22 2014 946 pm no dice reply installing and configuring citrix storefront 252 and configure load balancing on net scaler 105  robin hobocom august 26 2014 904 pm … in citrx storefront for configuring citrix storefront for remote access see my blog about that here these steps must only apply on the first …reply justin august 28 2014 852 pm great walkthrough – thank you once everything is in place what is your base url for connectivity it is difficult to read in the screenshot would it be something like httpsmyvpnmycompanycom or is there more after that reply robin hobo august 29 2014 825 pm my base url is httpsstorefronthobolan this is my internal base url the url of receiver for web url adds citrixhobo web on the end please let me know if you have any more questions reply serg september 3 2014 644 am hi robin that is a great article thank youi am stuck at ip addressing which address should be used here “netscaler gateway ip address this is the ip address where the outside ip address must point to”in my home lab i have external ip eg 220220220145 my home network 19216810 my lab network 1010100 vmware workstation and separate vlan my netscaler has two nics from both networks so which ip should be used as ns gateway ip reply robin hobo september 3 2014 831 pm hi serg in which lan do you want to setup the gateway you must configure nat from your external ip to the ip of the new gateway and is must be possible to connect to the storefront and xen desktop servers from the snip address of the net scaler reply serg september 4 2014 640 am actually the main goal for me is to make my gateway accessible from outside of my network so it is not really important in which lan to setup lab – 10 or home – 192 but as my home router is in 192 network so i can configure port forwarding and as i understand i have to put my gw to the same network i have two snip configured for both networksreply daniel september 15 2014 219 pm hi robinthanks a lot for this very good how to everything is working just the session is not open up i get this error message“cannot start desktop”how can i troubleshoot this do you have an advise thanks reply robin hobo september 20 2014 903 am is there any firewall blocking the traffic from the net scaler snip address to the xen app  xen desktop servers reply robert october 10 2014 957 pm i am also getting the “cannot start desktop” message on the outside world i have https forwarded in from the firewall to the netscaler internally things are fine any thoughts are appreciated replysiva september 22 2014 1018 pm hi robingreate article looking forward more article from you regards sivasankar reply brett october 17 2014 901 pm great guide as alwaysone thing i would like to see is how to use sha256 to create csr’s now that sha1 is being phased out many thanksreply grant october 23 2014 529 pm hi robinthanks for sharing following your step by step guide i got the netscaler with storefront running we are also using godaddy ssl cert and had bought 2 certs wildcard multi domains 1 for the netscaler and 1 for the storefront server we also set the internal storefront url and external netscaler access gateway url the same and of course the 2 certs we got from godaddy includes the both same internal and external url while connecting through windows machines everything works perfectly fine but not though mac os and i pad devices on mac os safari has no problem with the godaddy cert but once the app is launching and when citrix receiver is kicked in the citrix receiver will not launch the app and display the following message“you have not chosen to trust “go daddy secure certificate authority – g2″ the issuer of the server’s security certificate”tried to manually add the cert to mac os keychain but no joy on i pad citrix receivers says “certificate not trusted” when adding an account even the ignore certificate warnings is checked still no joy any idea why would this happen something to do with the ssl cert chain cheers reply grant october 23 2014 603 pm just one more thing to add the netscaler never com pain that the chain of the cert is incomplete like your screen shot cheers reply robin hobo october 25 2014 629 am that’s strange because this problem accord because you are probably missing the intermediate certificate that’s why it’s not trusted on a mac or i pad while other devices have no problem with that you can check if the chain is complete on a ssl checker site like httpswwwsslcheckercomsslchecker you can download your missing go daddy certificates here httpscertsgodaddycomrepository reply markus october 29 2014 428 pm hi robin thanks for your very good post it is possbile to loadbalance and monitor storefront ssl 26 and xml service 80 runniing on the same xendesktop controller server with the default ports reply robin hobo october 30 2014 635 am yes that is possible reply adrian november 5 2014 1055 am thank you so much this guide worked like a dream reply craig simpson november 27 2014 1242 am great article very informative i do also have a question particularly around monitors for storefront on my netscaler 101 in the dmz when i add the storefront monitor to my server group both server state is down if i remove this and use say a standard https monitor all 3 state up the only thing i can think of is firewall at this moment i have enabled ports 80443could you breakdown port access required for the storefront monitors to show up when passing from dmz to internal storefront servers that would help me out a great deal thanks in advance craig reply robin hobo december 1 2014 1213 pm there are some bugs in the first releases of net scaler 105 in the storefront monitor have you upgraded to the latest built version replydan november 27 2014 1118 pm hi robin great presentation i have followed your steps and almost there except after i provide user name and password i am getting “cannot complete your request” only when accessing it externally internally works fine i have wildcard ssl and to the best of my knowledge it’s installed on the netscaler i am using the latest netscaler 105539 any idea what i am missing regards dan reply robin hobo december 1 2014 1212 pm can the net scaler resolve the store front address and if so is the correct ssl certificate linked on the v server reply alireza december 1 2014 826 am dear robin my knowledge in citrix is low i deployed netscaler about sta i haven’t found any good instruction i have xenapp 76 and didn’t find anything on xenapp 75 and 76 i found ctxstadll on cprogram filescitrixbrokerservice i created scripts folder and published it on iis and add execute permission in handler mapping when i login too httpsgateway netvpnindexhtml i find this error http11 internal server error 43531 could you help me reply robin hobo december 1 2014 1207 pm your sta is your xen desktop controller so for example httpxdcontroller01 also make sure the net scaler can resolve this name optionally you can enter the ip address of the xen desktop controller reply alireza december 2 2014 451 pm dear robin i changed the fqdn to ip now it’s ok thanks still when i login to xenapp from gateway i have this error http11 internal server error 43531reply norman december 3 2014 444 pm this is a great article thanks so much for putting this up made my deployment a cinchreply armin december 10 2014 144 am dear robin we have ns 105 539 i pad 529 15 and storefront 26 comodo certificate with android  windows receiver everythings ok with i pad connection is starting  servererror  more info  server was disconnected from session any hints are welcome regards armin reply robin hobo december 10 2014 617 am hi armin have you created session policies for the i pads for more info see httpsupportcitrixcomarticlectx124937reply tom vb december 10 2014 909 pm hey robinit is important to use only az and 09 symbols in the passwords symbols like  or  are not supported in the interface on the commandline it will work reissued different times to find out the difference after checking the website i found the problems for googlers invalid password netscaler gateway thanks for this postreply robin hobo december 11 2014 418 pm thanks for sharing that regards robin reply tom vb december 12 2014 831 am one thing more it is from a local network not possible to access the public ip from your environment it will cause in this error error cannot complete your request fix to connect on your sf server open cwindowssystem32driversetchosts add 192168110 ngtomvanxxxnl your urlthis will connect the domain directly to the public internal ip ngtomvanxxxnl is reachable another way is to add a second vserver but this is my way reply robin hobo december 13 2014 832 pm that’s true and i always do that on the same way you described it thanks for mention that it was missing in the blog reply mike january 21 2015 921 pm it looks like vmware put out a patch that the netscaler vm’s do not get along with i rolled back my vmware host to the previous patch level and all is well sitting up the second netscaler for ha went smooth afterwards reply james t february 20 2015 942 am hi robinexcellent guide i’m testing this on an inside lan only for now and all working as expected my only issue is when i try to launch an application through the netscaler i get the below error message“unable to launch your application cannot connect to the citrix xenapp server ssl error 43 the proxy denied access to 10sta—–port 1494if i browse straight to the webinterface url the applications launch fine any thoughtsthanks reply james t february 20 2015 227 pm changing the sta to be the ip rather than name seems to have fixed this reply asif khan february 26 2015 1116 pm thanks for sharing a great net scaler 105 guide love it replyjane february 28 2015 1232 pm hi robin i have set up netscaler with 2 network interfaces one internal and one dmz the internal interface has the management ip and subnet ip and the dmz network is bound to the the virtual gateway address via vlan id yet i keep getting a page cannot be displayed everytime the url for the netscaler is launched on the dmz address nating to the external ip hasnt been established yet firewall is set to allow all can you please advice everything seems to be in order thanks reply robin hobo march 1 2015 810 am hi jane check your routings for example is de default gateway set to the gateway in the dmz reply jane march 2 2015 1015 am hi robin that was it working now thank you so much for your guides and the advice it has been really helpful replyyuri march 6 2015 634 pm hello robinthank for article but can you help me with the question i am publishing xen app auth – ok i can see my apps but on clicking them i got starting connection in progresshere the file — encoding input encodingutf8 wfclient proxy favor ieconnection settingyes proxy timeout30000 proxy typeauto proxy use fqdnoff remove icafileyes transparent key passthroughlocal transport reconnect enabledoff version2 virtual comport emulationon application servers 1c предприятие 1c предприятие address40sta403729188909da1d48dc153397ff516f63c9581 autologon allowedon browser protocolhttpon tcp cgpsecurity ticketon clear password84e3cfbbf145d0 client audioon desired color8 desired hres0 desired vres0 domainda86a5a38b69b1f1 do not use default cslon encryption level sessionenc rc5128 font smoothing type0 httpbrowser address initial program1c предприятие launcherwi launch reference8df12224cdfbc4698ae803b87f9e9e loc http browser address logon ticket84e3cfbbf145d0da86a5a38b69b1f1 logon ticket typectxs1 long command line lpwd101 nrwd64 proxy timeout30000 proxy typeauto secure channel protocoldetect sessionsharing keymi7tbxzx as9qc rmn mdhb g7kf xswg6g y sfrallowedoff sslciphersall sslenableon sslproxy hostmymstmgextaddr 443 title1c предприятие transport drivertcpip trwd0 twimodeon win station driverica 30 compress driver name win16pdcompwdll driver name win32pdcompndll enc rc50 driver name win16pdc0wdll driver name win32pdc0ndll enc rc5128 driver name win16pdc128wdll driver name win32pdc128ndll enc rc540 driver name win16pdc40wdll driver name win32pdc40ndll enc rc556 driver name win16pdc56wdll driver name win32pdc56ndll —thank youreplyzax march 18 2015 251 pm great article – thanks for the time you spent on thisreplysagar april 17 2015 1004 am very nice article – my query is i dont want to ldap authentication at netsclar level  wanted to display directly storefron web page  can this is possible  reply robin hobo april 18 2015 805 pm no that is not possible anymore with wi you can but not with store front reply christian may 11 2015 1244 pm thank you for this article robin great work do you have anything written up integrating latest mdm and xen desktopapp with netscaler 105 using the same fqdn and ssl cert reply robin hobo may 14 2015 619 am hi christian not yet it’s on my list reply brian may 20 2015 533 pm hi robin great write up and appreciate all the guides you publish they have been a huge help i had a question in regards to https for internal traffic i currently have a ssl cert installed on the netscaler from go daddy and https works great for external traffic i’m using the basic netscaler vpx and only have one storefront server and wanted to know if i needed to purchase another cert for internal 443 or if that one very is enough reply robin hobo may 30 2015 939 pm hi brian you can install your own certificate authority within your own domain and create a certificate for your internal store front address as long as you install the root certificate of your internal domain on the net scaler reply brad june 5 2015 1205 am firstly great articleregarding comment above “you can install your own certificate authority within your own domain and create a certificate” i have a question…i’ve just installed a netscaler vpx express and i have 2 x storefronts in terms of a certificate i was about to buy a verisign cert which i assume i only install on the netscaler vpx express is it mandatory to put a certificate on the storefronts to secure traffic between the netscaler and storefronts if so can i use the external cert or so i have to create an internal certificate i’m worried about the complexity of the internal certs when i thought i only had to install a cert for the external facing netscaler…reply robin hobo june 11 2015 1124 am hi brad your internal lb address for your store front servers is properly different than that of your external net scaler gateway address therefor you need a different certificate for your store front lb address this can be a certificate created by your own cert auth if using an internal domain name for your fqdn storefront lb the root ca of your internal domain must be installed on the net scaler and be bind at the gateway v server for your external access you need a public trusted ssl cert kind regards robin reply hamed b december 23 2015 841 am so great attractive full of detail and well described guide i couldn’t leave the page before say to robin hobo thank you in this page you described the scenario in my mind so you are a mind reader reply robin hobo december 26 2015 1234 pm thanksreply raihan march 9 2016 430 am great work reply geoge varghese september 10 2016 1208 am hi robin my storefront ns93 works fine on internal network 19216810024 but when i access applications externally via access gateway i get a msg “there is no xenapp server configured with this specified address” i have come across a few articles which say “to proxy the ica traffic through one nated ip address” can you please advise where these settings are on netscaler appreciate your help thanks george reply robin hobo september 11 2016 756 am hi geoge no only https 443 traffic must be nated and http 80 optional if you want to redirect http to https there must be a misconfiguration in the gateway vs on the net scaler itself er the firewall ports open from the snip address to the xen app servers reply np october 10 2016 1241 pm hi i have followed all these steps with netscaler 105 and store front 36 but i get “http error 404 the requested resource is not found” error after logging in any suggestions to debug this problemreply robin hobo october 19 2016 644 am hi np check the store front url including storename in the net scaler configuration also check if any ports are blocked on the firewall from the snip address to the storefront servers regards robin replydoua november 8 2016 739 pm hi i have a netscaler 5500 and citrix support helped me setup the netscaler gateway virtual server and web interface site i got an ssl cert from godaddy and testing internally works fine i want to test externally can you tell me what ports to open and which ip do i need to nat to the public ip is it the sip nip or netscaler gateway virtual server ip there is no storefront installed thank you reply robin hobo december 8 2016 653 am hi doua it is port 443 nat rule must be from external ip to gateway vip reply jared march 30 2017 812 pm hi i attempted this with netscaler 111 and sf 39 i tried to use the export net scaler gateway configuration feature on the netscaler to upload on sf but received the message “gateway v server receiver for web url does not match the store front receiver for web urls” i entered in the netscaler gateway manually in sf as you directed but after logging in through the unified gateway i just get a blank white screen any suggestions reply leave a reply your email address will not be published required fields are marked 