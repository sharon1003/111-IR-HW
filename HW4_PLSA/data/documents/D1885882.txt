how to delete a user from office 365 which has been synced with dirsync i have been testing some things with my account in office 365 unfortunately where people are testing thing go wrong somehow my user in office 365 got corrupted and all of my things in the cloud were unavailable luckily  it was a test user and no actual data got lost first things first i want to point out that deleting a user in office 365 using this method also deletes the corresponding mailbox and all the other settings for other office 365 products only use this as a last effort to delete the usermailbox so we need to delete the user from office 365 easy just log in to the portal browse to the user and click delete wellno because the users got synced with dirsync ad is leading and therefore the user cant be deleted from the portal well then i tried deleting the user with microsoft online module for powershell  installed on adfs  first connecting to the msolservice and importing the cmdlets to manage office 365 next step was removing the user with the following command removemsoluser userprincipalname userlogonname again ad is leading so powershell gave me the following error then i thought ad is leading dirsync is ilm so there must be another way and there is using the ilm console we can successfully delete a user from offie 365 without deleting the user in ad it is recommended to do this just after a sync because we dont want dirsync to start syncing while we are changing things in ilm open the ilm console on the dirsync server  cprogram filesmicrosoft online directory syncsyncbusuishellmiiclientexe then open the tab  metaverse search the metaverse is a database that keeps track of user data from all the connected systems in this case we only have 2 systems ad and office 365 so in the met averse search we will find one user  person  with data from ad and office 365 create a new search scope to find the user you want to delete from office 365 once the user is found double click the user open the tab connectors  you will see 2 connectors one with all the imported data from ad and one with all the exported data to office 365 select the ad connector  where management agent value is source ad and click disconnect so only the office 365 connector  target web service  remains this simulates the user being deleted from ad as there is no longer any data present for the ad connector next go to the management agents tab right click the target web service connector and choose run select the full confirming import run profile and click ok repeat the steps above and choose the export run profile instead of the confirming import when the export is finished the user object is deleted from office 365 this is also shown in the history under the operations tab in ilm click the last task and the deletion will be shown in the bottom left corner in the next sync the user will be recreated in office 365 if you want to create a new onpremise mailbox for the user  because the online mailbox is deteled and there is no onprem mailbox  there are a couple of extra steps to follow if you open the exchange emc right away and use the  newmailbox  command for the just deleted user you will notice the emc cannot find your user as it searches for users with no mailbox to create a new mailbox for the existing user you have to clear all the exchange attributes in ad for that user if you open the attribute editor you will notice that all the exchange attributes remain in ad if you dont clear the values exchange emc will not create a new mailbox open the properties of a user without a mailbox and check which attributes had no value clear the ones that dont have a value with the non mailbox enabled user again only use this as a last effort because all mailbox content is deleted if this happens with a normal user instead of a test user there is a way to get your emails back with my test user i opened outlook in offline mode and created a pst cached mode needs to be enabled for this to work when the new mailbox was created i imported the pst and the emails are back hope you dont have to use this but its good to know how a user can be deleted gepost door harmjan van tiel op zaterdag oktober 15 2011 dit emailen dit bloggen delen op twitter delen op facebook delen op pinterest labels dirsync  hybrid deployment  ilm  office365  powershell  troubleshooting 