docs windows 7 windows 7 technical library roadmap deployment upgrade and migration stepbystep basic windows migration using usmt for it professionals stepbystep basic windows migration using usmt for it professionals june 29 2010 13 minutes to read in this article requirements step 1 gather data using the scan state tool step 2 install windows 7step 3 apply data using the load state tool next steps see also applies to windows 7the windows® user state migration tool usmt 40 is designed to help it professionals migrate files and settings to the windows® 7 operating system usmt 40 is a microsoft application intended for administrators who are performing largescale automated deployments for deployment to a small number of computers or for individually customized deployments you can use windows easy transfer for more information see windows 7 upgrade and migration guide this stepbystep guide to windows migration for it pros provides a basic example of how to migrate files and settings from windows xp to windows 7 using usmt 40 you can also migrate files and settings from a computer running windows vista® at the end of this process you will have used the scan state and load state tools to complete an endtoend migration you can also customize your migration by editing configuration files used by these tools for a comprehensive description of all of the tools and configuration files see the user state migration tool usmt 40 users guide usmtchm downloaded with the windows automated installation kit windows aik or this microsoft web site in this example you gather data from a source computer running windows xp create a migration store using the default settings in scan state install windows 7 on a new or newly repartitioned computer and then apply data from the migration store this process includes step 1 gather data using the scan state tool step 2 install windows 7step 3 apply data using the load state tool requirements to complete this scenario you need the following windows 7 product dvd disc windows automated installation kit windows aik dvd disc you can download the windows aik iso file from this microsoft web site and burn the iso file onto a blank dvd disc a source computer a source computer requires a network adapter a working network environment and a dvdrom drive this guide uses a source computer running windows xp however you can also use a source computer running windows vista if you choose to use this guide with windows vista the interface will differ slightly from that of windows xp and you may have to modify some of the steps for actions on that operating system but the usmt syntax will remain the same note if you do not use the optional destination computer the source computer will be reformatted for the purposes of this scenario create a backup of the source computer before testing your migration with usmt network connectivity a technician computer a technician computer can be any computer on which you will install the windows aik the technician computer must be running windows server® 2003 windows vista or windows 7 this computer also requires a dvdrom drive after you have installed the windows aik on the technician computer you can copy the usmt to other computers in your organization optional a destination computer a destination computer is the computer onto which you intend to migrate files and settings this computer requires a network adapter a working network environment and a dvdrom drive for this example you can reuse the source computer as your destination computer after you create a migration store on a server you can then reformat the hard drive of the source computer returning it to a blank state the source computer will then become your destination computer optional installation software for applications for which you will migrate files and settings note the application version that is installed on the destination computer should be the same version as the one on the source computer usmt does not support migrating the settings for an older version of an application to a newer version the exception to this is microsoft® office applications which usmt can often migrate from an older version to a newer version step 1 gather data using the scan state tool there are two migration scenarios migrating to a new operating system on a single computer is known as pc refresh migrating to a separate destination computer is known as pc replacement for more information about pc refresh and pc replacement see common migration scenarios in most pcrefresh scenarios you can perform a hardlink migration use of a hardlink migration store drastically improves migration performance and significantly reduces harddisk space usage for more information about hardlink migrations see hardlink migration store in some pcrefresh scenarios however such as repartitioning the drive you cannot use a hardlink migration store in this case you must create a compressed or uncompressed migration store instead this is called a pcreplacement scenario and is similar to the steps you use when migrating files and settings to a new computer in this stepbystep guide you will create a compressed migration store on a server that can be used in either a pcrefresh or pcreplacement scenario install the usmtyou can install the windows aik on any computer running a supported operating system such as windows vista or windows 7 after the windows aik is installed you can copy usmt files and tools to other computers in your organization on a computer running an operating system that is supported by windows aik insert the windows aik dvd into the dvdrom drive the setup program automatically starts note if the setup program does not start automatically in windows explorer browse to the dvd drive containing the windows aik dvd and then click start cdexe click windows aik setup to begin the installation follow the online instructions copy all of the contents of cprogram fileswindows aiktoolsusmt architecture to a network share or usb port architecture can be either x86 or amd64 for example at a command prompt typexcopy cprogram fileswindows aiktoolsusmtx86 fileserverusmtx86copy the usmt files and tools to the source computer for example on the source computer at a command prompt typexcopy fileserverusmtx86 cusmtnote only the scan state tool is supported on windows xp for usmt 40 other usmt and windows aik tools such as load state and windows system image manager windows sim are not supported on windows xp to use the windows aik to create an answer file or a customized windows image for deployment you must install the windows aik on a computer running a supported operating system optional create a test account to migrate if you are using a source computer that has not been customized by a user to include personal files and modifications such as desktop wallpaper you should create a test account in order to test and verify a successful migration to create a local test account on a windows xp computer that is not joined to a domain click start click control panel click user accounts and then click create a new account type usmt tester and then click create account click close to create a local test account on a windows xp computer that is joined to a domain click start click control panel and then click user accounts in the user account window click the advanced tab under advanced user management click advanced in the local users and groups pane click users on the action menu click new user type usmt tester in the user name text box type a password that you will remember or make a note of it click the user must change password at next logon check box to clear it and then click create click close optional add files and settings to a test account make any other changes to the usmt tester account that you would like to test during the migration for example copy files from a usb flash drive ufd or a network share to the my documents folder for the test account you can use txt files or a sample of file types you would like to migrate for more information see what does usmt migrate copy or create test files on the c drive set a custom desktop wallpaper builtin wallpaper images such as tulipsjpg on windows xp will not migrate instead save a new image file to the source computer to use as wallpaper change the font color in the commandprompt application map a network drive set the home page in internet explorer® optional preview what usmt will migrate in usmt 40 the mig xml helper generate doc patterns function can be used to automatically find user documents on a computer without authoring extensive custom migration xml files this function is included in the mig docsxml sample file downloaded with the windows aik to preview what usmt will migrate click start click all programs click accessories rightclick command prompt and then click run as select an account with administrator privileges supply a password and then click ok at the command prompt typecd d usmtpath scanstateexe genmigxmlfilepathxmlwhere usmtpath is the location on your source computer where you have saved the usmt files and tools and filepathxml is the full path to a file where you can save the report for example typecd d cusmt scanstateexe genmigxmlcdocuments and settingsusmt testerdesktopgen migxmlopen the file that scan state generated at the location you specified this guide shows the patterns that you will use in the migration when you run scan state and specify the mig docsxml sample file in the commandline options find the component element for usmt tester in the xml file it will look like thiscomponent typedocuments contextstressmarmotusmt tester default supportedyesreview the folders and file patterns that will be migrated for this account for example the following line shows that all files in the usmt testermy documents folder will be migratedpattern typefilecdocuments and settingsusmt testermy documents patternfor more information on what usmt migrates and how to determine what types of files and settings are best to migrate for your organization see plan your migration for more information about customizing configuration files see customize usmt xml files run scan state to create a migration store on the server by default the scan state tool will create a compressed migration store this guide uses the default compressed migration store that is applicable to both pcrefresh and pcreplacement scenarios for most pcrefresh scenarios however you can also use a hardlink migration store which improves performance for more information see hardlink migration store to create a migration store on a server log on to the source computer as an account that has administrator privileges this account should also have permissions to the network share where you will create your migration store open a command prompt click start click all programs click accessories and then click command prompt run scan state on the source computer to collect files and settings typecd d usmtpath scanstate store path imigdocsxml imigappxml v13 llog file pathwhere usmtpath is the location on your source computer where you have saved the usmt files and tools store path is the full path to a folder on a network server where you can create the migration store and log file path is the full or relative path to a file where you can save the scan state log information for example typecd d cusmt scanstate fileservermigrationmystore imigdocsxml imigappxml v13 lscanlog optional review the scan state log for help with usmt errors see troubleshooting step 2 install windows 7after you create a migration store on a server you will install windows 7 and load the files and settings from that migration store onto the destination computer you can reformat the source computer pc refresh and use it as your destination computer or you can use an additional computer pc replacement you must install windows 7 and any applications for which you will migrate files and settings onto your destination computer to install windows 7if your computer contains user data back up this data before reformatting to start windows 7 setup insert the windows 7 dvd while running windows choose your language options and then click install now if the autorun program does not open the install windows screen browse to the root folder of the dvd and doubleclick setupexe note you can use an unattended answer file to customize your windows 7 deployment for more information see stepbystep basic windows deployment for it professionals or the windows aik user’s guide read and accept the microsoft software license terms click i accept the license terms required to use windows and then click next if you click i decline cancel installation windows 7 setup will exit click custom advanced on the where do you want to install windows screen click drive options advanced click a partition and then click delete click ok if you want to delete the partition and any data on it if there are additional partitions repeat step 6 for each partition select the disk listed as unallocated space and then click new enter a partition size or click apply click ok windows will create the new partition as well as a system partition select the new partition and then click format click ok if you want to reformat the partition and delete any data on it click next windows 7 setup will proceed without further interaction install applications although it is not always necessary it is a best practice to install applications before loading files and settings from your migration store to install applications install all user applications on the destination computer the application version that is installed on the destination computer should be the same version as the one on the source computer usmt does not support migrating the settings for an older version of an application to a newer version the exception to this is microsoft® office which usmt can migrate from an older version to a newer version for more information about what applications and settings are supported in usmt 40 see what does usmt migrate close all applications if some applications are running when you run load state usmt might not migrate all of the specified data for example if microsoft office outlook® is open usmt might not migrate pst files which for example store a users local messages and calendar events step 3 apply data using the load state tool to apply migrated data to your hard drives you connect the computer to your network install usmt and then run load state to connect the computer to your network click start rightclick my computer and then click properties under computer name domain and workgroup settings click change settings in the system properties window click network id use the join a domain or workgroup wizard to connect to your local area network to install the usmtcopy the usmt files and tools to the destination computer from the ufd or network share where you have saved them for example on the destination computer at a command prompt typexcopy fileserverusmtx86 cusmtto run load state log on to the destination computer as an account that has administrator privileges this account should also have permissions to the network share where you created your migration store open a command prompt click start click all programs click accessories rightclick command prompt and then click run as administrator click yes to open the command prompt run load state on the destination computer specify the same set of xml files that you specified when using scan statecd d usmtpath loadstate store path imigdocsxml imigappxml lac lae v13 llog file pathwhere usmtpath is the location on your source computer where you have saved the usmt files and tools store path is the full path to a folder on a network server where you can create the migration store and log file path is the full or relative path to a file where you can save the scan state log information for example typecd d cusmtloadstate fileservermigrationmystore imigdocsxml lac lae imigappxml v13 lloadlog note the lac and lae options specify that local accounts such as the usmt tester account you may have created in step 1 will be created and enabled on the destination computer local account passwords will not be migrated you can specify a new password for the account in the load state command line if you do not specify a password the password for the account will be blank by default for more information see load state syntax optional review the load state log file for help with usmt errors see troubleshooting after the computer has been restarted you can verify that the usmt tester account was successfully migrated and that the test documents are present on the new computer you can log on to the usmt tester account and verify the migration of any of the customizations you made in step 1 next steps you can learn more about customizing your migration from the user state migration tool usmt 40 users guide usmtchm installed with the windows aik or at this microsoft web site see also concepts windows 7 upgrade and migration guide other resources user state migration tool 40windows automated installation kit for windows 7share  theme windows 7windows 7 technical library roadmap windows 7 service pack 1product evaluation getting started planning and architecture deployment application compatibility upgrade and migration windows 7 upgrade paths quick start checklist overview of usmtplan your migration usmt components using usmttroubleshooting usmt 40 xml reference windows 7 upgrade and migration guide stepbystep basic windows migration using usmt for it professionals stepbystep offline migration with usmt 40migrating files during a remote installation with usmt and windows deployment services migration xml files windows xp to windows 7 hardlink migration of user files and settings desktop deployment security and protection management and operations troubleshooting and support small and midsize business corner customer and mvp corner the it pro at home tips and tricks windows virtual pc and windows xp mode springboard series 