create a gist now instantly share code notes and snippets star 1111 fork 332oodavid  readmemdforked from aronwoostreadmemd last active apr 1 2018embed download zipcode revisions 15stars 1111forks 332deploy your site with git raw readmemd deploy your site with git this gist assumesyou have a local git repowith an online remote repository github  bitbucket etcand a cloud server rackspace cloud  amazon ec2 etcyour php scripts are served from varwwwhtmlyour webpages are executed by apacheapaches home directory is varwww this describes a pretty standard apache setup on redhat  ubuntu  cent os  amazon ami etcyou should be able to do the same with java perl ro r jsp etc however youll need to recreate the rather simple php script1  on your local machine here we add the deployment script and push it to the origin the deployment script runs git commands to pull from the origin thus updating your server grab a deployment script for your site see deployphp add commit and push this to githubgit add deployphp git commit m added the git deployment script git push u origin master2  on your server here we install and setup git on the server we also create an ssh key so the server can talk to the origin without using passwords etc install git after youve installed git make sure its a relatively new version  old scripts quickly become problematic as github  bitbucket  whatever will have the latests and greatest if you dont have a recent version youll need to figure out how to upgrade it git versionon cent os 56 add a nice repo rpm uvh httprepowebtaticcomyumcentos5latestrpm  install git yum install enablerepowebtatic gitallusing generic yumsudo yum install gitcore setup gitgit config global username server git config global useremail serverservercomcreate an ssh directory for the apache usersudo mkdir varwwwssh sudo chown r apacheapache varwwwsshgenerate a deploy key for apache usersudo hu apache sshkeygen t rsa  choose no passphrase sudo cat varwwwsshidrsapub3  on your origin github  bitbuckethere we add the ssh key to the origin to allow your server to talk without passwords in the case of git hub we also setup a postreceive hook which will automatically call the deploy url thus triggering a pull request from the server to the origin git hub instructions add the ssh key to your userhttpsgithubcomsettingsssh create a new key paste the deploy key you generated on the server set up service hookhttpsgithubcomoodavidservercomadminhooks select the postreceive url service hook enter the url to your deployment script  httpservercomdeployphp click update settings bitbucket instructions add the ssh key to your accounthttpsbitbucketorgaccountsshkeyscreate a new key paste the deploy key you generated on the server set up service hook go to repo  admin  services select postadd the url to your deployment script  httpservercomdeployphp save thanks to drew apicture in the comments for this one4  on the server here we clone the origin repo into a chmodded varwwwhtml folder pull from originsudo chown r apacheapache varwwwhtml sudo hu apache git clone gitgithubcomyouservergit varwwwhtml rejoicenow youre ready to go some notes navigate the the deployment script to trigger a pull and see the outputhttpservercomdeployphpthis is useful for debugging too when you push to git hub your site will automatically ping the above url and pull your codewhen you push to bitbucket you will need to manually ping the above url it would be trivial to setup another repo on your server for different branches develop releasecandidate etc  repeat most of the steps but checkout a branch after pulling the repo down sources build autodeploy with php and git hub on an ec2 amazon ami instance  who in turn referencedec2webapp  installmd how to deploy your code from git hub automatically rawdeployphpphp git deployment script used for automatically deploying websites via github or bitbucket more deets here httpsgistgithubcom1809044 the commandscommands  array  echo pwd  whoami  git pull  git status  git submodule sync  git submodule update  git submodule status  run the commands for outputoutput   foreach  commands as command   run ittmp  shellexec  command  outputoutput   span style  color 6be234    span span style  color 729fcf    command  n span output  htmlentities  trim  tmp   n  make it pretty for manual user access and why not doctype html html lang   enus   head  meta charset   utf8   title git deployment script title  head  body style   backgroundcolor 000000 color ffffff fontweight bold padding 0 10px   pre          span style   color ff0000   ♥ ♥  span    git deployment script v01   © oodavid 2012 php echo output  pre  body  html drew apicture commented jun 21 2012fyi i got this to work using bit bucket pretty easily they may have made allowances for post requests in the last few months on bit bucket went to the repo  admin  services selected post dropped in my url and saved it seems to be working as expected thanks for the script it makes my life a lot easier owneroodavid commented jun 21 2012glad it helped you out  the real trick for me was getting it so that apache could play nicely with gitnebriv commented jul 31 2012thanks it works well for me on shared hosting without keysbgallagh3r commented aug 21 2012just a heads up it would be smart to add git reset hard head in the commands before git pull if for some reason your working directory is dirty files changed log files created etc then the deploy will fail resetting the head to the last commit will prevent a deploy failuremattbanks commented aug 23 2012do you worry about security of the deployphp script is there any harm is someone hits that script or anything malicious they can doweblance2 commented sep 7 2012got stuck here any ideas on how to change permissionsrootstaging  sudo hu apache sshkeygen t rsa  choose no passphrase generating publicprivate rsa key pair enter file in which to save the key varwwwsshidrsa githubkey enter passphrase empty for no passphrase enter same passphrase again open githubkey failed permission denied saving the key failed githubkeyweblance2 commented sep 7 2012i created a key by skipping the create directory but now i get rootstaging  sudo hu apache git clone gitgithubcomweblance2primarytrunkgit varwwwhtml fatal destination path varwwwhtml already exists and is not an empty directorynatxet commented sep 29 2012as mattbanks says no securityjamesbrooks commented oct 11 2012this might interest you james brooksgitrunner with the gitrunnerdeploy gemjamesbrooks commented oct 11 2012httpsgithubcomjames brooksgitrunner even jorijnsmit commented nov 26 2012i got this working but am missing why i created ssh keys if i understand the script correctly anyone can hit the url  httpservercomdeployphp and it will execute a git pull how is the difference detected between the git hub web hook service and a random visitor or a web crawler i think i will do some more digging i found httpsgithubcomcoppertinogithubwebhook with a similar function but more advanced options like ip filtering and sshftp supportmarkomarkovic commented jan 13 2013ive rewrote this gist and created a normal repository for it check it outit featureseasy configurationno need to create the clone on the server first its doing that automaticallybasic security through obscurity so the script cant be triggered by anyone except the one who knows the secretupdate the code using nonmaster branchdelete files that are no longer in the repository dangerous ignore certain filesdirectories when updatingerror detection if any step prior to deploy fails nothing is changedstamp the deployed code versionbackup the target prior to deployzanematthew commented jan 22 2013if this is all local why not just use native git using a working tree and a bare repohttpsgistgithubcom4597331httpstackoverflowcomquestions5283262whatisagitworktreewhyhaveineverneededtosetthisasanenvvarwhy also things like branch and other useful into are already coming over in the payload from the github postreceive hook httpshelpgithubcomarticlespostreceivehooks not sure why those are passed in via gettabacitu commented jan 29 2013awesome thanks just a headsup on ubuntu my user was wwwdata not apache drew apicture commented feb 11 2013mattbanks natxet re security two things i usually do is to rename the script to randomstringphp and modify it not to expose the username for all to see another option is to restrict referrer access to the script via htaccessdavemac commented feb 15 2013i agree with zanematthew this method seems like overkill for what can be accomplished with a postreceive hook and a bare repo on the target server or am i missing somethinganthonyringoet commented feb 24 2013already had ssh keys for my server because was pulling in changes manually im using this in development and works perfect for me thanksaguilarcarlos commented oct 21 2013this is only when my server is on php really at same i cant to build another for python its cool this congrats still i not test this but i think so it will function thanksvamsiikrishna commented jan 14 2014aguilarcarlos please check httpsgithubcomvamsiikrishnayelislouma2000 commented jan 25 2014in my case i needed to change etcpasswd centos 62apache ❌ 502503 apache serversbinnologin to apache❌502503 apache servervarwwwsbinnologinghost commented feb 2 2014another php tool for the job a bit more elaborate onehttpsgithubcomperennialsapachegitsynctooldrmikecrowe commented apr 16 2014ive found and recommend this httpmagephpcomjimoconnell commented jun 20 2014the last section sources has a truncated link should be httpwritingmarkchristianorg20110310howtodeployyourcodefromgithubautomaticallyhtmlzenware commented aug 28 2014your tag link to the deployphp file is incorrect it should be httpsgistgithubcomoodavid1809044filedeployphpmukeshrane commented nov 13 2014i need help actually i did all the steps to auto update production updates from master branch and staging updates from staging branch it works but only for production server what i want is when i will push my changes to any working branch and merge it will staging branch my updates automatically goes to staging server and when i will merge my staging branch to master branch my updates automatically goes to production server martin lyne commented jan 28 2015if you changetmp  shellexec command to tmp  shellexec command 21it will show error output too handy when in wrong directory etcnickk80 commented jan 31 2015i become every time this when i execute manually deployphp on branch masternothing to commit working directory cleanif i made changes to the master on github the post process and the deployphp do nothing  im to be desperate to do this i kill all an go on your readme 4 times and every time with the same problemsneakyimp commented mar 12 2015some security issues with thisif the github repo is public any clown in the world can coopt your server into their botnet deployphp doesnt even bother to validate that the incoming ping is actually from github the approach described here fails to describe how one sets up a secret to sign the hook payload or to check that payload in php if this were implemented on a shared host then pretty much anyone could take a peek at the ssh keys both private and public every single file in your web root can be written by apache on a shared host your files are at the mercy of anyone else on the server even if your machine is a singlepurpose one a single vulnerability in your code could easily compromise your entire web rootmssyogi commented may 21 2015i m unable to got working i hit the url with post hook as well as the browser but not get updated my repohttpwwwawesomescreenshotcomimage24853029451649e6bfd2fd5da472d6915c9a82noelboss commented jun 23 2015ive found little tools to help deploy your code from github or gitlab so i created deeplio to handle webhooks and call scripts to deploy on your own server this handles the json thats sent from github or gitlab and uses your own script to react you can use your own php or shell scripts after receiving the pull notification check it out httpdeepliolimzykenneth commented jul 2 2015i modified the php script which should comply with githubs instruction on webhooks while also updated the instructions deploy your site with git securelydustindwyer commented aug 10 2015if you have permission problems with git pull but you can still git status make sure your git folders are owned by your apache git user a git pull needs permission to modify the git files our solutionchown r wwwdatawwwdata gitfrom repository root directory effecti x commented aug 19 2015for security you couldadd at the beggining of the fileif isset get randomvar  get randomvar randomvalue  exit nope  and add randomvarrandomvalue to the webhook url when you create it rename the file to something random this  you should do it anywaysuse htaccess rules for that file  allowdeny and whitelist the ranges given by github or bitbucket for the webhooks not sure what they are for github but for bitbucket its this table col that is labeled as outbound for hooks like postthats about all that comes to mind thanks for the scriptadnanh commented nov 21 2015instead of a php script one could use webhook and a shell script for security one can define trigger rules to include github payload signature check etcerm3nda commented jan 21 2016hum i heard something that say it uses github to deploy code ill use it as its perfect to sync the code what im thinking now is that i would not publish sensible php data into the github public repo i suspect that the user added bitbucket due to its private free repos wich one of the suggested worked more like out of the box i prefer simpler than complex just sync regardsrobbiegod commented jun 8 2016looks interesting i noticed a small problem in your gist the anchor link to see deployphp is incorrect the anchor is currently filedeployphp but actually should be filedeployphpghost commented jun 13 2016 •edited by ghost hi allthanks in advance i am new to jenkin and ci my question is below my project is in angular node and express js and scm is git so i want to automate the build and deployment via jenkins so please help me on this as of now i have configured the gitub plugin in jenkins which get trigger when we make any commit i need the script which help to deploy the changes to windows web server note  i am working on windowsjdmagic21 commented jul 8 2016i like your script idea but i agree with bgallagh3r  if something happens were a file is deleted a git pull is not bring this file back you have to use a git resetdavidp mfa commented jul 13 2016the shellexec command on the git pull doesnt do anything for me all other git commands run finejestherthejoker commented jul 19 2016hey ive successfully created the and deploy the initial private reporepository but after all while trying to git pull the ssh key was rejected can you help me with this machine is running on ubuntu 14tareq1988 commented jul 28 2016apologize if it seems a promotion but made this tool gitpull as a hosted serviceavramovic commented aug 14 2016 •editedtareq1988 this seems nice but you should add an option to execute custom commands beforeafter git pull for example if i want to migrate the database after git pull also add some feedback form so you can get ideas such as this one from your usersxgqfrmsgit hub commented sep 20 2016not too badburningbaal commented oct 30 2016the link for setting up service hook  httpsgithubcomoodavidservercomadminhooks doesnt work 404benyanke commented feb 16 2017i would suggest optionally adding git reset hard to ensure the pull happens correctly if youre using the git workflow properly it shouldnt matter if local changes are dumped because all the important files should be in the repo anywaysgeobde commented feb 16 2017hi guys i try this method with gitlab and dont work you have any ideaswebassic15 commented mar 30 2017hi i am using ubuntu os i cloned repo from bitbucket on local env  set the ssh key access if i tried to pull  push via terminal then all is working fine but if i run that script on my local then getting a error  host key verification failedfatal could not read from remote repository also whoaim command showing a user  wwwdata but i am using webdev user on my system please help to resolve this issueagrublev commented apr 7 2017 •edited for those interested on ubuntu this is what you have to do sad nobody added it yet took me an houredit etcsudoers to add wwwdata all  nopasswd usrbingit then add to the git pull in deployphp sudo git pullwithout this i could not pullkirannani commented apr 10 2017i have nginx server how can i do thatadrianoprospero commented apr 22 2017great script its running like a charm with bitbucket thank you for the helpxenu256 commented jun 5 2017isnt it better to name things more appropriatelyhttpsgithubcom username projectadminhooksoinstead ofhttpsgithubcomoodavidservercomadminhooks kiodaddy commented jun 14 2017great script its working finescriptburn commented jun 29 2017why not use this httpsgithubcomscriptburngitautodeploy and save typing all these commandsjackdeguest commented aug 29 2017if the purpose is to publish a git repository to a live server then just cut the middle man this explains how to use git to publish from the local host to the remote server directly and using different possible branch like beta live etc to which one can associate sub domain for validation for example httpswwwdigitaloceancomcommunitytutorialshowtosetupautomaticdeploymentwithgitwithavpsadnanh commented sep 24 2017heres another approach httpsmediumcomhookdooautomaticdeploymentonpushtogithubrepository74190c87eee4mckaycr commented sep 25 2017this was easy to integrate thanks i use 1and1 shared webservice or whatever its call bottomline it doesnt support ssh keys only passwords unless i upgrade to the next package upgrading is probably not an option for my nonprofit group is there a way to implement this so that the server doesnt need a key to pull changes from my custom gitlab servernatefr commented oct 23 2017 •edited this script is vulnerable do not use it exploitation httpswwwexploitdbcomghdb4593pdulapalli commented jan 3 2018quick question is this script easily adapted for nginx serverswale cloud commented jan 9 2018quick question please i dont understand the url to your deployment script  httpservercomdeployphp whats my url to the deploy scriptudezekene commented mar 4 2018wale cloud you are supposed to upload the deployphp script included here to your server httpservercomdeployphp represents the path to the deployphp file on your own serverdomain sign up for free to join this conversation on git hub  already have an account sign in to comment 